<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Chat en Vivo</title>
    <style>
        #chatBox {
            width: 80%;
            height: 300px;
            border: 1px solid #ddd;
            margin: 0 auto;
            overflow-y: scroll;
            padding: 10px;
        }
        #messageInput {
            width: 78%;
            padding: 10px;
        }
        #sendButton {
            width: 20%;
            padding: 10px;
        }
    </style>
</head>
<body>
<div id="chatBox"></div>
<input type="text" id="messageInput" placeholder="Escribe tu mensaje aquÃ­...">
<button id="sendButton">Enviar</button>

<script>
    var ws = new WebSocket("ws://localhost:7000/chat");
    var messageHistory = []; // Initialize an empty history

    ws.onopen = function() {
        console.log("Conectado al WebSocket");
    };

    ws.onmessage = function(event) {
        var message = JSON.parse(event.data);
        document.getElementById("chatBox").innerHTML += message + '';
    };

    ws.onerror = function(error) {
        console.log("Error en WebSocket: ", error);
    };

    document.getElementById("sendButton").onclick = function() {
        var message = document.getElementById("messageInput").value;
        messageHistory.push({role: 'user', content: message}); // Add the user's message to the history
        console.log("Sending message: ", JSON.stringify({history: messageHistory})); // Log the message that's being sent

        if (ws.readyState === WebSocket.OPEN) {
            ws.send(JSON.stringify({history: messageHistory})); // Send the history to the server
        } else {
            console.log("WebSocket connection is not open. Ready state: ", ws.readyState);
        }

        document.getElementById("chatBox").innerHTML += '<br>' + 'Yo: ' + message + '<br>'; // Agregar tu mensaje a la caja de chat
        document.getElementById("messageInput").value = ''; // Limpiar el campo de entrada
    };

    document.getElementById("messageInput").onkeypress = function(e) {
        if (e.keyCode === 13) { // Tecla Enter
            document.getElementById("sendButton").click();
        }
    };
</script>
</body>
</html>